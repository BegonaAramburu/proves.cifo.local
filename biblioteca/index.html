<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

<!-- 	<link href="/your-path-to-fontawesome/css/fontawesome.css" rel="stylesheet">
 	<link href="/your-path-to-fontawesome/css/brands.css" rel="stylesheet">
 	<link href="/your-path-to-fontawesome/css/solid.css" rel="stylesheet">  -->
 	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
 		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
 	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">
  
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.js"></script>
 	
	<title>Biblioteca</title>
	<link rel="stylesheet" href="/css/style.css">
</head>
<body>
	
	<!--Creación del Navegador ---------------------------------------------------------------------->
	
	<nav class="navbar navbar-expand-md fixed-top p-0 pr-2 navbar-dark bg-info">
		<div >
		    <img src="/img/soc.jpg"  height="55px" alt="Logo SOC">
			<a class="navbar-brand p-0 m-0 d-inline-block text-wrap" style="line-height: 1em; " href="#">Servei d'Ocupació<br> de Catalunya</a>
		</div>
		<button class="navbar-toggler " type="button" data-toggle="collapse"
			data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown"
			aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button> 
		<div class="collapse navbar-collapse justify-content-end" id="navbarNavDropdown">
			<ul class="navbar-nav ">
				<li class="nav-item active"><a class="nav-link" href="#">Centros</a></li>
				<li class="nav-item"><a class="nav-link" href="#">Oferta formativa</a></li>
				<li class="nav-item"><a class="nav-link" href="#">Biblioteca</a></li>
				<li class="nav-item"><a class="nav-link" href="#">Contacto</a></li>
				<li class="nav-item"><a class="nav-link d-block d-md-none d-lg-block" href="/campus/index.html">Campus virtual</a></li>
				<li class="nav-item"><a class="nav-link  d-block d-md-none d-lg-block" href="#">Entrar</a></li>
				<li class="nav-item"><a class="nav-link d-block d-md-none d-lg-block" href="#">Regístrate</a></li>
				<li class="nav-item dropdown d-none d-md-inline d-lg-none">
					<a class="nav-link dropdown-toggle" href="#"
					id="navbarDropdownMenuLink" role="button" data-toggle="dropdown"
					aria-haspopup="true" aria-expanded="false"> eCampus </a>
					<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
						<a class="dropdown-item" href="/campus/index.html">Campus Virtual</a> 
						<a class="dropdown-item" href="#">Entrar</a>
						<a class="dropdown-item" href="#">Regístrate</a>
					</div>
				</li>
			</ul>
		</div>
	</nav>
	
	<!-- Creación del breadcrumb y redes sociales---------------------------------------------------------------------->
	
	<div class="row mx-2 border-bottom border-secondary" style="margin-top:55px">
		<div class="col p-0 ">
	 		<nav aria-label="breadcrumb"> 
	 			<ol class="breadcrumb m-0 mt-3 bg-transparent p-0">
	 		 		<li><i class="fa fa-home text-info"></i></li>
	 		 		<li class="breadcrumb-item text-info pl-2"><a href="/index.html">Inicio</a></li>
	    			<li class="breadcrumb-item active " aria-current="page">Centros</li>
	  		 	</ol>
			</nav>
		</div>
		<div class="col d-flex py-2 justify-content-end align-items-center">
	    	<a class="mr-1 p-1 py-1 d-inline-block rounded-circle text-white" style="background-color:#1B1FBA" href="#"><i class="fa fa-facebook fa-fw "></i></a>
	      	<a class="mr-1 p-1 py-1 d-inline-block rounded-circle text-white" style="background-color:#00acee" href="#"><i class="fa fa-twitter fa-fw"></i></a>
	      	<a class="mr-1 p-1 py-1 d-inline-block rounded-circle text-white" style="background-color:#CC4115" href="#"><i class="fa fa-google-plus fa-fw"></i></a>
	      	<a class="mr-1 p-1 py-1 d-inline-block rounded-circle bg-dark text-white" href="#"><i class="fa fa-instagram fa-fw"></i></a>
	      	<a class="mr-1 p-1 py-1 d-inline-block rounded-circle bg-danger text-white" href="#"><i class="fa fa-pinterest fa-fw"></i></a>
		</div>
	</div>
 
 <!-- Creación del contenido ---------------------------------------------------------------------->
 	
	<div class="row m-0 mb-2">
		<div class="col-12 pt-3">
			<h3>Biblioteca</h3>
		</div>
	</div>
	
	<div class="container">
		<div class="row m-0 pb-3 "> <!--  d-flex -->
		
		  <div id="selectores" class="col-3">
    <p>Secciones</p>
    <select id="secciones">
      <option value="0">-- Escoja una sección --</option>
    </select>
     <p>Temas</p>
    <select id="temas">
      <option value="0">-- Escoja un tema --</option>
    </select>
        <p>Editoriales</p>
    <select id="editoriales">
      <option value="0">-- Escoja un tema --</option>
    </select>
    <div class="d-flex justify-content-center">
    <button type="button" class="btn btn-danger" id="borrar" onclick="borrar()">Borrar</button>
    <button type="button" class="btn btn-info" id="filtrar" onclick="filtrar()">Filtrar</button>
    </div>
  </div>
  <div class="col-8">
    <table class="display" id="libros">
      <thead>
        <tr>
          <th>Isbn</th>
          <th>Cubierta</th>
          <th>Título</th> <!--  style="width: 30%" -->
          <th>Editorial</th>
          <th>Sección</th>
            <th>Tema</th>
        </tr>
      </thead>
      <tbody id="tbllibros"></tbody>
    </table>
  </div>
		
	
		</div><!-- row -->
	</div>	<!-- container -->
	
<!-- Creación del footer ---------------------------------------------------------------------->	
			<!-- ---------------redes sociales----------------------------------- -->
	<footer id="footer" class="container-fluid text-light">
		<div class="row d-flex justify-content-center align-items-center">
	      <a class="mr-1 p-1 py-2 d-inline-block  bg-transparent text-light" href="#"><i class="fa fa-twitter fa-2x fa-fw "></i></a>
	      <a class="mr-1 p-1 py-2 d-inline-block bg-transparent text-light" href="#"><i class="fa fa-facebook fa-2x fa-fw"></i></a>
	      <a class="mr-1 p-1 py-2 d-inline-block bg-transparent text-light" href="#"><i class="fa fa-google-plus fa-2x fa-fw"></i></a>
	      <a class="mr-1 p-1 py-2 d-inline-block bg-transparent text-light" href="#"><i class="fa fa-instagram fa-2x fa-fw"></i></a>
	      <a class="mr-1 p-1 py-2 d-inline-block bg-transparent text-light" href="#"><i class="fa fa-pinterest fa-2x fa-fw"></i></a>
		</div>
		   <!-- ---------------directo a----------------------------------- -->
		<div class="row mt-4">
			<div class="col-12 col-md-3 d-flex justify-content-center text-center">
				<ul type="none" class="p-0 mb-5 mb-md-2">
					<li class="text-white"><h6>DIRECTO A</h6></li>
					<li><a class="text-light" href="/centros/index.html">Centros</a></li>
					<li><a class="text-light" href="#">Oferta formativa</a></li>
					<li><a class="text-light" href="#">Biblioteca</a></li>
					<li><a class="text-light" href="#">Contacto</a></li>
					<li><a class="text-light" href="/campus/index.html">Campus virtual</a></li>
					<li><a class="text-light" href="#">Entrar</a></li>
					<li><a class="text-light" href="#">Registrarse</a></li>
				</ul>
			</div>
			 <!-- ---------------ayuda----------------------------------- -->
			<div class="col-12 col-md-3 d-flex justify-content-center text-center">
				<ul type="none" class="p-0 mb-5 mb-md-2">
					<li class="text-white"><h6>AYUDA</h6></li>
					<li><a class="text-light" href="#">Sobre gencat</a></li>
					<li><a class="text-light" href="#">Accessibilitat</a></li>
					<li><a class="text-light" href="#">Mapa web</a></li>
					<li><a class="text-light" href="#legal">Aviso Legal</a></li>
				</ul>
			</div>
			 <!-- ---------------aviso legal--------------------------------- -->
			<div class="col-12 col-md-6">
				<div class="text-center d-flex justify-content-center">
					<h6 class="text-white" id="legal">SERVEI D'OCUPACIÓ DE CATALUNYA</h6>
				</div>
				<p class="col-12 d-flex justify-content-center class text-center mb-5 mb-md-2">
				 Aviso legal : De acuerdo con el artículo 17.1 de la Ley 19/2014, la © Generalidad de Cataluña permite la reutilización de los contenidos y de los datos siempre que
	se cite la fuente y la fecha de actualización y que no se desnaturalice la información (artículo 8 de la Ley 37/2007) y también que no se contradiga con una licencia específica.
				</p>
				
				<div class="row">
					<div class="col-6">
						<img src="/img/sepelogotip.jpg" title="logotipo sepe" alt="logotipo sepe" class="img-fluid">
					</div>
					<div class="col-6">
						<img src="/img/logotip_Iniciativaocupaciojuvenil_bn.jpg" title="logotipo sepe" alt="logotipo sepe" class="img-fluid">
					</div>
				</div>
			</div>
		</div>
		<div class="d-flex justify-content-center class text-center py-3 ">Copyright © Cifo 2018 </div>
     </footer>
<script>
$(document).ready( function () {
    $('#libros').DataTable();
} );

//Mostra la taula sencera en carregar la pagina
	window.onload=function() {
var xhr;
if (window.XMLHttpRequest) {
	xhr = new XMLHttpRequest();
} else {
	xhr = new ActiveXObject("Microsoft.XMLHTTP");
}

xhr.onreadystatechange = function() {
		if (xhr.readyState == 4 && xhr.status == 200) {
			var arrLibros = JSON.parse(xhr.responseText);
			console.log(arrLibros.records);
			for (var i = 0; i < arrLibros.records.length; i++) {
				//console.log(arrLibros.records[i].nombre);
				var cadena='<tr>'+
				'<td>'+arrLibros.records[i].isbn+'</td>'+
				'<td><img src="'+arrLibros.records[i].cubierta+'" height="100px"></td>'+
			//	'<td>Aquí va la cubierta</td>'+
				'<td>'+arrLibros.records[i].titulo+'</td>'+
				'<td>'+arrLibros.records[i].editorial+'</td>'+
				'<td>'+arrLibros.records[i].seccion+'</td>'+
				'<td>'+arrLibros.records[i].tema+'</td>'+
			//	'<td><a href="javascript:void(0)" onclick="getCurs('+arrCursos[i].id+')" data-toggle="modal" data-target=".bd-example-modal-sm">[+info...]</a></td>'+
				'</tr>';
				document.getElementById('tbllibros').innerHTML+=cadena;
	
			}
		}
}
	
	xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/libros/?nocache='+Math.random(), true);
	xhr.send(); 
}	

//Mostra el primer selector
var xhr;
if (window.XMLHttpRequest) {
	xhr = new XMLHttpRequest();
} else {
	xhr = new ActiveXObject("Microsoft.XMLHTTP");
}

	xhr.onreadystatechange = function() {
		if (xhr.readyState == 4 && xhr.status == 200) {
			var arrSecciones = JSON.parse(xhr.responseText);
			console.log(arrSecciones.records);
			for (var i = 0; i < arrSecciones.records.length; i++) {
				console.log(arrSecciones.records[i].nombre);
				document.getElementById("secciones").innerHTML += '<option id="'+ arrSecciones.records[i].id +'" value="' + arrSecciones.records[i].nombre + '">'+ arrSecciones.records[i].nombre +'</option>';
	
			}
		}
	}
	xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/secciones/?nocache='+Math.random(), true);
	xhr.send();

	
	
	
	//Mostra el segon selector quan seleccionem el primer 
	document.getElementById("secciones").onchange = function() {
		document.getElementById("temas").innerHTML = '<option value="0">-- Escoja un tema --</option>';
			
			
		//	document.getElementById("tblMunicipios").innerHTML = '<option value="">-- Escull un municipi --</option>'
			
			var seccioseleccionada = document.getElementById("secciones").selectedIndex;
			var codiseccio = document.getElementById("secciones").options[seccioseleccionada].id;
			console.log(codiseccio);
			
			if (window.XMLHttpRequest) {
				xhr = new XMLHttpRequest();
			} else {
				xhr = new ActiveXObject("Microsoft.XMLHTTP");
			}
			
				xhr.onreadystatechange = function() {
					if (xhr.readyState == 4 && xhr.status == 200) {
						var arrTemas = JSON.parse(xhr.responseText);
						console.log(arrTemas);
						for (var i = 0; i < arrTemas.records.length; i++) {
							console.log(arrTemas.records[i].nombre);
							document.getElementById("temas").innerHTML += '<option id="'+ arrTemas.records[i].id +'" value="' + arrTemas.records[i].nombre + '">'+ arrTemas.records[i].nombre +'</option>';
						}
					}
				}
				xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/temas/seccion/'+ codiseccio +'/&nocache=' +Math.random(), true);
				xhr.send();
			
			
		
			
	}
	
	
	//Mostra el selector editorials
	window.onpageshow=function() {
		document.getElementById("editoriales").innerHTML = '<option value="0">-- Escoja un tema --</option>';
	var xhr;
if (window.XMLHttpRequest) {
	xhr = new XMLHttpRequest();
} else {
	xhr = new ActiveXObject("Microsoft.XMLHTTP");
}

	xhr.onreadystatechange = function() {
		if (xhr.readyState == 4 && xhr.status == 200) {
			var arrEditoriales = JSON.parse(xhr.responseText);
			console.log(arrEditoriales.records);
			for (var i = 0; i < arrEditoriales.records.length; i++) {
				console.log(arrEditoriales.records[i].nombre);
				document.getElementById("editoriales").innerHTML += '<option id="'+ arrEditoriales.records[i].id +'" value="' + arrEditoriales.records[i].nombre + '">'+ arrEditoriales.records[i].nombre +'</option>';
	
			}
		}
	}
	xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/editoriales/?nocache='+Math.random(), true);
	xhr.send();
	
	}
	
	
	var temasactivado = false;
	var editorialesactivado = false;
	
	document.getElementById("temas").onfocus = function() {
		temasactivado = true;
		editorialesactivado = false;
	}
	
	document.getElementById("editoriales").onfocus = function() {
		editorialesactivado = true;
		temasactivado = false;
		
	}
	
	
	function filtrar() {
		
		if (temasactivado == true) {
	
	document.getElementById("tbllibros").innerHTML = "";
	//var codiseccio = document.getElementById("secciones").selectedIndex;
	var posicioseleccionada = document.getElementById("temas").selectedIndex;
	console.log(posicioseleccionada);
	var coditema
	for (i=0; i<document.getElementById("temas").options.length; i++) {
		if (i==posicioseleccionada) {
			coditema = document.getElementById("temas").options[i].id;
		console.log(coditema);	
		}
	}
	 if (window.XMLHttpRequest) {
		xhr = new XMLHttpRequest();
	} else {
		xhr = new ActiveXObject("Microsoft.XMLHTTP");
	}

		xhr.onreadystatechange = function() {
			if (xhr.readyState == 4 && xhr.status == 200) {
				var arrLibros = JSON.parse(xhr.responseText);
				console.log(arrLibros);
				for (var i = 0; i < arrLibros.records.length; i++) {
					console.log(arrLibros.records[i]);
					//console.log(arrLibros.records[i].id);
					//console.log(arrLibros.records[i].nombre);
					//console.log(arrLibros.records[i].duracion);
					//document.getElementById("tblAreas").innerHTML += '<option id="'+ arrAreas[i].id +'" value="' + arrAreas[i].nombre + '">'+ arrAreas[i].nombre +'</option>';
					 //   <th>Isbn</th>
   //   <th>Cubierta</th>
    //  <th>Título</th> <!--  style="width: 30%" -->
     // <th>Editorial</th>
      //<th>Sección</th>
       // <th>Tema</th> 
					var cadena='<tr>'+
					'<td>'+arrLibros.records[i].isbn+'</td>'+
					'<td><img src="'+arrLibros.records[i].cubierta+'" height="100px"></td>'+
				//	'<td>Aquí va la cubierta</td>'+
					'<td>'+arrLibros.records[i].titulo+'</td>'+
					'<td>'+arrLibros.records[i].editorial+'</td>'+
					'<td>'+arrLibros.records[i].seccion+'</td>'+
					'<td>'+arrLibros.records[i].tema+'</td>'+
				//	'<td><a href="javascript:void(0)" onclick="getCurs('+arrCursos[i].id+')" data-toggle="modal" data-target=".bd-example-modal-sm">[+info...]</a></td>'+
					'</tr>';
					document.getElementById('tbllibros').innerHTML+=cadena;
					
					
				}
			}
			
			
		}
		xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/libros/tema/'+ coditema +'/&nocache=' +Math.random(), true);
		xhr.send();  
	}
		
	 else {
		
		
		
		document.getElementById("tbllibros").innerHTML = "";
		
		var posicioseleccionada = document.getElementById("editoriales").selectedIndex;
		console.log(posicioseleccionada);
		var codieditorial
		for (i=0; i<document.getElementById("editoriales").options.length; i++) {
			if (i==posicioseleccionada) {
				codieditorial = document.getElementById("editoriales").options[i].id;
			console.log(codieditorial);	
			}
		}
		 if (window.XMLHttpRequest) {
			xhr = new XMLHttpRequest();
		} else {
			xhr = new ActiveXObject("Microsoft.XMLHTTP");
		}

			xhr.onreadystatechange = function() {
				if (xhr.readyState == 4 && xhr.status == 200) {
					var arrLibros = JSON.parse(xhr.responseText);
					console.log("hola");
					console.log(arrLibros);
					for (var i = 0; i < arrLibros.records.length; i++) {
						console.log(arrLibros.records[i]);
						var cadena='<tr>'+
						'<td>'+arrLibros.records[i].isbn+'</td>'+
						'<td><img src="'+arrLibros.records[i].cubierta+'" height="100px"></td>'+
					//	'<td>Aquí va la cubierta</td>'+
						'<td>'+arrLibros.records[i].titulo+'</td>'+
						'<td>'+arrLibros.records[i].editorial+'</td>'+
						'<td>'+arrLibros.records[i].seccion+'</td>'+
						'<td>'+arrLibros.records[i].tema+'</td>'+
					//	'<td><a href="javascript:void(0)" onclick="getCurs('+arrCursos[i].id+')" data-toggle="modal" data-target=".bd-example-modal-sm">[+info...]</a></td>'+
						'</tr>';
						document.getElementById('tbllibros').innerHTML+=cadena;
						
						
					}
				}
				
				
			}
			xhr.open('GET', 'http://app.cifo.local/api/public/biblioteca/libros/editorial/'+ codieditorial +'/&nocache=' +Math.random(), true);
			xhr.send();  
		
	}
	}
</script>
	<!-- Optional JavaScript -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
	<script
		src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>
</html>